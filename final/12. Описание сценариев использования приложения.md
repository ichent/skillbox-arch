*Сценарий 1. Начало тренировки и сбор телеметрии (Offline-First)*

Цель: Пользователь хочет начать беговую тренировку в лесу, где нет интернета, и сохранить данные GPS и пульса.
Акторы: Спортсмен, Мобильное приложение, GPS-модуль, Bluetooth-датчик пульса.
Предусловие: Пользователь авторизован, Bluetooth включен.

Шаги воспроизведения:
1. Пользователь из главного меню выбирает тип активности «Бег» и нажимает кнопку «Старт».
2. Приложение инициализирует подключение к внешнему датчику пульса (через BLE) и модулю GPS.
3. Приложение создает новую запись в локальной БД (Realm/SQLite) со статусом started.
4. Каждую секунду приложение опрашивает сенсоры и записывает координаты/пульс в локальный буфер.
5. Пользователь нажимает «Стоп», затем «Сохранить».
6. Приложение закрывает запись в локальной БД и помечает её статусом pending_sync.
7. Приложение проверяет доступность сети.
* Альтернативный поток: Если сети нет, данные остаются на устройстве до появления соединения (фоновая задача).

Ожидаемый результат: Тренировка сохранена локально без потери данных. При появлении интернета данные автоматически отправляются на сервер.


*Сценарий 2. Анализ завершенной тренировки и получение достижений (Event-Driven)*

Цель: Пользователь хочет увидеть детальную статистику и получить награды за выполнение целей.
Акторы: Спортсмен, Сервис тренировок, Сервис геймификации, Сервис уведомлений.
Предусловие: Тренировка успешно синхронизирована с сервером.

Шаги воспроизведения:
1. Сервис тренировок (Training Service) сохраняет данные в TimescaleDB и публикует событие TrainingFinished в шину сообщений (Kafka).
2. Сервис геймификации (Gamification Service) считывает событие, анализирует параметры тренировки (дистанция > 10 км) и начисляет пользователю 500 XP.
3. Сервис инвентаря (Inventory Service) считывает событие и увеличивает счетчик износа кроссовок на 10 км.
4. Пользователь открывает экран «Детали тренировки».
5. Приложение запрашивает агрегированные данные (график темпа, карта) у Backend API.
6. Приложение отображает всплывающее окно (Toast/Modal) «Получено достижение: Марафонец» и «Кроссовки изношены на 80%».

Ожидаемый результат: Пользователь видит корректную статистику, обновленный уровень профиля и актуальное состояние инвентаря в реальном времени.


*Сценарий 3. Поиск партнеров для совместной тренировки (Search)*

Цель: Пользователь хочет найти бегунов своего уровня в радиусе 5 км для совместной пробежки в субботу.
Акторы: Спортсмен, Сервис поиска (Elasticsearch), Сервис профилей.

Шаги воспроизведения:
1. Пользователь переходит в раздел «Поиск» и задает фильтры:
* Вид спорта: «Бег».
* Локация: «Мое текущее местоположение» + радиус 5 км.
* Уровень: «Средний» (pace 5:00-5:30 мин/км).
2. Приложение отправляет запрос GET /api/users/search?lat=...&lon=...&sport=running.
3. Сервис поиска обращается к индексу Elasticsearch (Geo-spatial query) и возвращает список ID подходящих пользователей.
4. Приложение отображает список карточек пользователей с кратким описанием.
5. Пользователь нажимает «Пригласить на тренировку» на карточке подходящего партнера.

Ожидаемый результат: Список релевантных пользователей загружается менее чем за 2 секунды.


*Сценарий 4. Добавление и настройка нового инвентаря*

Цель: Пользователь купил новый велосипед и хочет добавить его в приложение для отслеживания ТО.
Акторы: Спортсмен, Сервис инвентаря, Внешняя база данных товаров.

Шаги воспроизведения:
1. Пользователь заходит в раздел «Инвентарь» -> «Добавить».
2. Пользователь сканирует штрих-код на раме велосипеда или вводит название модели вручную.
3. Приложение запрашивает данные о товаре в каталоге партнеров (внешнее API).
4. Приложение предзаполняет форму характеристиками (Бренд, Модель, Рекомендуемый интервал ТО цепи: 500 км).
5. Пользователь подтверждает данные и нажимает «Сохранить».
6. Сервис инвентаря создает новую запись в PostgreSQL и привязывает её к профилю пользователя.

Ожидаемый результат: Велосипед отображается в списке активного оборудования. При выборе тренировки типа «Велоспорт» оно будет предлагаться по умолчанию.


*Сценарий 5. Получение Push-уведомления о критическом износе*

Цель: Предупредить пользователя о необходимости замены цепи, чтобы избежать поломки в пути.
Акторы: Сервис инвентаря, Сервис уведомлений, Пользователь.
Предусловие: Пользователь не пользуется приложением в данный момент (Background).

Шаги воспроизведения:
1. Фоновая задача (Cron Job) в Сервисе инвентаря проверяет состояние оборудования всех пользователей.
2. Обнаружено условие: «Пробег цепи (510 км) > Ресурса (500 км)».
3. Сервис инвентаря отправляет команду в Сервис уведомлений: SendPush(user_id, "Внимание! Цепь изношена").
4. Сервис уведомлений отправляет сообщение через Firebase Cloud Messaging (FCM).
5. На телефоне пользователя появляется системное уведомление: «Пора на ТО! Ваша цепь прошла 510 км».
6. Пользователь нажимает на уведомление и попадает на экран обслуживания инвентаря.

Ожидаемый результат: Пользователь своевременно проинформирован о рисках, повышена лояльность и безопасность.