1. Разработанная архитектура представляет собой распределенную микросервисную систему, ориентированную на обработку событий в реальном времени (Event-Driven Architecture). Выбор данного архитектурного стиля обусловлен необходимостью обеспечения высокой Масштабируемости (Scalability) для обработки пиковых нагрузок во время массовых спортивных мероприятий и Надежности (Reliability) сохранения данных тренировок в условиях нестабильной сети.

2. Ключевые архитектурные решения (ADR Mapping)
    1. Архитектура базируется на следующих фундаментальных решениях, закрывающих поставленные бизнес-цели и атрибуты качества: Компонент / Технология, Решаемая бизнес-задача, Адресуемый атрибут качества
        1. Microservices (Docker + K8s); Независимое развитие модулей "Тренировки" и "Инвентарь". Быстрый Time-to-Market для новых фич.; Масштабируемость: Возможность точечного скейлинга сервиса телеметрии. Модифицируемость: Легкость внесения изменений.
        2. Event-Driven (Apache Kafka); Асинхронная обработка данных после тренировки (начисление баллов, расчет износа инвентаря) без задержки ответа пользователю.; Производительность: Разделение контура записи (быстро) и аналитики (асинхронно). Надежность: Гарантия доставки событий (at-least-once).
        3. Polyglot Persistence; Оптимизированное хранение разнородных данных: IoT-метрики (TimescaleDB), профили (PostgreSQL), лидерборды (Redis).; Производительность: Быстрая вставка временных рядов (Ingestion rate) и молниеносное чтение рейтингов.
        4. Offline-First (Mobile/SQLite); Возможность тренироваться в удаленных локациях без интернета с гарантией сохранения трека.; Доступность и Надежность: Приложение работоспособно 24/7 вне зависимости от статуса сети.
        5. API Gateway (Nginx/Kong); Единая точка входа, скрывающая сложность микросервисов от мобильных клиентов.; Безопасность: Централизованная аутентификация и защита от DDoS (Rate Limiting).

3. Компонентный состав системы
    1. Система декомпозирована на следующие основные функциональные блоки:
        1. Мобильный клиент (React Native)
            - Отвечает за взаимодействие с пользователем и сбор данных с сенсоров.
            - Реализует логику Smart Sync: накопление данных в локальной БД (Realm) и фоновую отправку пакетами при наличии Wi-Fi, экономя заряд батареи.
        2. Сервисный слой (Backend)
            1. Identity Service (Go + PostgreSQL): Центральный сервис аутентификации (на базе Keycloak). Обеспечивает SSO и валидацию прав доступа.
            2. Training Core Service (Python + TimescaleDB): "Сердце" системы. Принимает поток сырых данных (GPS, Heart Rate), валидирует их (фильтрация выбросов) и сохраняет в специализированную Time-Series БД.
            3. Inventory Service (Java + PostgreSQL): Управляет жизненным циклом снаряжения. Подписан на события Kafka TrainingFinished для автоматического обновления пробега кроссовок/велосипеда.
            4. Gamification Service (Java + Redis): Геймификация в реальном времени. Рассчитывает достижения и обновляет Redis Leaderboards для мгновенного отображения рейтингов.
            5. Social Service (Node.js + Elasticsearch): Обеспечивает социальные взаимодействия. Использует Elasticsearch для быстрого полнотекстового и гео-поиска партнеров по тренировкам.
        3. Инфраструктура данных
            - Apache Kafka: Магистральная шина данных. Связывает все микросервисы, обеспечивая слабую связность (Decoupling).
            - S3 Object Storage: Хранилище медиа-контента (фото с тренировок, аватарки).
            - ELK Stack (Elasticsearch, Logstash, Kibana): Централизованная система сбора логов для оперативного выявления проблем (Observability).

4. Реализация атрибутов качества
    1. Производительность (Performance): Достигается за счет использования Redis для часто запрашиваемых данных (рейтинги, профили) и асинхронной обработки тяжелых задач (аналитика тренировки) через Kafka. Ожидаемое время отклика API < 200 мс.
    2. Масштабируемость (Scalability): Обеспечивается оркестратором Kubernetes (HPA), который автоматически добавляет экземпляры сервиса Training Core при росте нагрузки (например, во время марафона).
    3. Надежность (Reliability): Гарантируется паттерном Offline-First на клиенте (данные не теряются при обрыве связи) и репликацией баз данных (Master-Slave) на сервере.
    4. Безопасность (Security): Все данные передаются по TLS 1.3. Персональные данные (PII) хранятся в зашифрованном виде. Доступ к API только по JWT-токенам.
